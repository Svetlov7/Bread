$(function () {

    msieversion();
    //page career - mobile btn open more
    $('.open-mobile').click(function (e) {
        e.preventDefault();
        $('.info__block.company__info.block-reverse').slideDown();
        $(this).hide();
        $('.info__text.career__text').css('margin-bottom', 0)
    })



    var s = $(".header_button"), e = $(".header_mobmenu-container");
    s.click(function () {
        $(this).toggleClass("open"), e.toggleClass("open")
    }),

        $(".banner_slider").slick({
            slidesToShow: 1,
            slidesToScroll: 1,
            arrows: !1,
            fade: !1,
            asNavFor: ".banner_dots",
            draggable: !1,
            swipe: !1,
        }), 
        $(".banner_dots").slick({
        slidesToShow: 5,
        slidesToScroll: 0,
        asNavFor: ".banner_slider",
        dots: !1,
        centerMode: !0,
        focusOnSelect: !0,
        arrows: !1
    }), $(".slider_wrapp").slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        arrows: !0,
        fade: !1,
        responsive: [{breakpoint: 981, settings: {dots: !1, arrows: !1}}]
    });

    var item_length = $('.banner_slider .slide-item-sl').length - 3;
    
    
    // On before slide change
    $(".banner_slider").on('afterChange', function(event, slick, currentSlide, nextSlide){
        //check the length of total items in .slide container
      //if that number is the same with the number of the last slider
      //Then pause the slider
      if( item_length === $(".banner_slider").slick('slickCurrentSlide') ){
        //this should do the same thing -> slider.slickPause();
        $(".banner_slider").slickSetOption("autoplay",false,false)
      };
    });

    var o = $(".header_mobmenuwrapp ul li.menu-item-type-custom a");
    o.click(function () {
        o.removeClass("clicked"), $(this).addClass("clicked")
    });
    var l = $(".header"), r = $(".header_before");
    $(window).on("scroll", function () {
        $(window).scrollTop() > 0 ? l.hasClass("scrolled") || (l.addClass("scrolled"), r.addClass("scrolled")) : (l.removeClass("scrolled"), r.removeClass("scrolled"))
    })


    $('.position').val($('.vacancy__title').text())
        .attr('readonly', true);

    var wpcf7Elm = document.querySelector( '.wpcf7' );

    if (wpcf7Elm ){
        wpcf7Elm.addEventListener( 'wpcf7mailsent', function( event ) {
            $('.feedback-form div.wpcf7, div.wpcf7').css('display','none');
            $('p.decription').css('display','none');
            $('.feedback-form .thanks, .thanks').addClass('open');
            $('.position').val($('.vacancy__title').text())
                .attr('readonly', true);

        }, false );
    }



    //form validation
    var validName = false;
    var validPhone = false;
    var validEmail = false;
    var validSub = true;
    var validTextar = false;

    // $('.feedback .feedback-form form .textarea .input').focus(function() {
    //   $(this).parent().parent().find('.placeholder').css('display','none');
    // });

    $('.feedback-form .required, .form-wrapper input').focusout(function () {

        if ($(this).hasClass('name') || $(this).hasClass('fio')) {
            if ($(this).val().length < 2) {
                $(this).addClass('invalid-val');
                $(this).removeClass('valid-val');
                // $(this).parent().next().addClass('invalid');
                // $(this).parent().next().removeClass('valid');
                validName = false;
            } else {
                validName = true;
                // $(this).parent().next().addClass('valid');
                // $(this).parent().next().removeClass('invalid');
                $(this).removeClass('invalid-val');
                $(this).addClass('valid-val');
            }
        }
        else if ($(this).hasClass('phone')) {
            var phoneVal = $(this).val();
            var phoneLngth = phoneVal.length;
            if ($(this).val().match('^(\\s*)?(\\+)?([- _():=+]?\\d[- _():=+]?){5,14}(\\s*)?$')) {
                validPhone = true;
                // $(this).parent().next().addClass('valid');
                // $(this).parent().next().removeClass('invalid');
                $(this).removeClass('invalid-val');
                $(this).addClass('valid-val');
            }
            else {
                // $(this).parent().next().addClass('invalid');
                // $(this).parent().next().removeClass('valid');

                $(this).addClass('invalid-val');
                $(this).removeClass('valid-val');


                validPhone = false;
            }

        }
        else if ($(this).hasClass('email')) {

            if ($(this).val().match('^[-\\w.]+@([A-z0-9][-A-z0-9]+\\.)+[A-z]{2,6}$') && $(this).val().length > 0) {
                // $(this).parent().next().addClass('valid');
                // $(this).parent().next().removeClass('invalid');
                $(this).removeClass('invalid-val');
                $(this).addClass('valid-val');
                validEmail = true;
            } else {
                validEmail = false;
                // $(this).parent().next().addClass('invalid');
                // $(this).parent().next().removeClass('valid');

                $(this).addClass('invalid-val');
                $(this).removeClass('valid-val');
            }
        }
        // else if ($(this).hasClass('sub')) {
        //     if ($(this).val().length < 2) {
        //         $(this).parent().next().addClass('invalid');
        //         $(this).parent().next().removeClass('valid');
        //         validSub = false;
        //     } else {
        //         validSub = true;
        //         $(this).parent().next().addClass('valid');
        //         $(this).parent().next().removeClass('invalid');
        //     }
        // }
        else if ($(this).hasClass('textar')) {
            if ($(this).val().length < 2) {
                $(this).addClass('invalid-val');
                $(this).removeClass('valid-val');
                // $(this).parent().next().addClass('invalid');
                // $(this).parent().next().removeClass('valid');
                // $(this).parent().parent().find('.placeholder').css('display','block');
                validTextar = false;
            } else {
                validTextar = true;
                // $(this).parent().next().addClass('valid');
                $(this).removeClass('invalid-val');
                $(this).addClass('valid-val');
                // $(this).parent().next().removeClass('invalid');
            }
        }

        if ((validName == true) && (validEmail == true) && (validPhone == true) && (validSub == true) && (validTextar == true)){
            $('.feedback .feedback-form form .btn').addClass('valid');
        }
    });
    $(document).ready(function () {
        $(".feedback-form form,  .form-wrapper form").submit(function () {
            $('.feedback-form .required,  .form-wrapper input').each(function () {
                if ( $(this).val().length === 0) {
                    $(this).addClass('invalid-val');
                    $(this).removeClass('valid-val');
                    // $(this).parent().next().addClass('invalid');
                    // $(this).parent().next().removeClass('valid');
                }
            });
        });


    });

    jQuery(function ($) {
        $(".input.phone").mask("+380 (99)999-99-99");
    });

    $('#file').change(function () {
        var txt = "";
        var file = $('#file')[0].files[0].name;
        $('#file-name').text(file);
        $('.delete').fadeIn();
    })
    $('.order').click(function (e) {
        e.preventDefault();
        $('body').css('overflow-y', 'hidden')
        $('.order-popup').addClass('open');
        $('.order-popup .wpcf7').show();
        $('.wpcf7-mail-sent-ok').hide();
        $('.input').removeClass('valid-val')
        $('.thanks').removeClass('open');
        $('p.decription').css('display','block');

        var product = $(this).closest('.long__item-content');
        var title = $(product).find('h2').text();
        var img  = $(product).find('img').attr('src');

        var sizes = [];
        $(product).find('.c-value').each(function () {
                sizes.push($(this).text());
        })
        $('.wpcf7-form-control.wpcf7-radio').html("");

        sizes.forEach(function (item, i) {
            $('.wpcf7-form-control.wpcf7-radio')
                .append(' <span class="wpcf7-list-item item'+i+'"><label><input type="radio" name="sizes" value="'+item+'" ><span class="wpcf7-list-item-label"> <img src="http://kyivkhlib.ua/wp-content/uploads/2018/03/weight_icon.svg" alt=""> '+item+'</span></label></span>')
         })
        $('#product-name').text(title);
        $("#product-image").attr("src", img );
        $('#pr-name').val(title)
        $('#pr-name').attr('readonly', true);
        $('.item0 input').attr('checked', true);
    })

    $('.close-it').click(function (e) {
        e.preventDefault();
        $('body').css('overflow-y', 'scroll')
        $('.order-popup').removeClass('open')
    });

    $('.delete').click(function (e) {
        e.preventDefault();
        $(this).hide();
        $("#file").val("");
        $('#file-name').text("Завантажити резюме (doc, docx, pdf до 2 Mб)");

    })


//    ankor links  - menu
    $(".ancor-link a").click(function (e) {
        e.preventDefault();
        var id  = $(this).attr('href'),
            top = $(id).offset().top - 105;



        // $('body').animate({scrollTop: top}, 1500);
        $('html, body').animate({
            scrollTop: top
        }, 'slow');
        console.log(top )
    })

    $('.order-popup ').click(function (e) {
        var container = $(".order-wrap, .long__item");
        if (container.has(e.target).length === 0){
            $('body, html').css('overflow-y', 'scroll')
            $('.order-popup').removeClass('open')
        }
    });

    setEqualHeight($(".production-types"));

    $('.toggle-btn').click(function (e) {
        e.preventDefault();
        $(this).toggleClass('open')
        $('.search-form').fadeToggle();

    })

    $(document).click(function (e) {
        var container = $("header");
        if (container.has(e.target).length === 0){
            $('.search-form').fadeOut();
            $('.toggle-btn').removeClass('open');

        }
    });

});


function msieversion() {

    var ua = window.navigator.userAgent;
    var msie = ua.indexOf("MSIE ");

    if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))  // If Internet Explorer, return version number
    {

        setEqualHeight($(".vacancies__item"));
        setEqualHeight($(".long__item"));
        $('.vacancies__item-wrapper').innerHeight( $('.vacancies__item-wrapper').parent().innerHeight())
        $('.long__item-content').innerHeight( $('.long__item-content').parent().innerHeight())


        // alert(parseInt(ua.substring(msie + 5, ua.indexOf(".", msie))));
    }
    else  // If another browser, return 0
    {
        // alert('otherbrowser');
    }

    return false;
}

function setEqualHeight(columns)
{
    var tallestcolumn = 0;
    columns.each(
        function()
        {
            currentHeight = $(this).height();
            if(currentHeight > tallestcolumn)
            {
                tallestcolumn = currentHeight;
            }
        }
    );
    columns.height(tallestcolumn);
}

// PHONE MASK
!function (a) {
    "function" == typeof define && define.amd ? define(["jquery"], a) : a("object" == typeof exports ? require("jquery") : jQuery)
}(function (a) {
    var b, c = navigator.userAgent, d = /iphone/i.test(c), e = /chrome/i.test(c), f = /android/i.test(c);
    a.mask = {
        definitions: {9: "[0-9]", a: "[A-Za-z]", "*": "[A-Za-z0-9]"},
        autoclear: !0,
        dataName: "rawMaskFn",
        placeholder: "_"
    }, a.fn.extend({
        caret: function (a, b) {
            var c;
            if (0 !== this.length && !this.is(":hidden")) return "number" == typeof a ? (b = "number" == typeof b ? b : a, this.each(function () {
                this.setSelectionRange ? this.setSelectionRange(a, b) : this.createTextRange && (c = this.createTextRange(), c.collapse(!0), c.moveEnd("character", b), c.moveStart("character", a), c.select())
            })) : (this[0].setSelectionRange ? (a = this[0].selectionStart, b = this[0].selectionEnd) : document.selection && document.selection.createRange && (c = document.selection.createRange(), a = 0 - c.duplicate().moveStart("character", -1e5), b = a + c.text.length), {
                begin: a,
                end: b
            })
        }, unmask: function () {
            return this.trigger("unmask")
        }, mask: function (c, g) {
            var h, i, j, k, l, m, n, o;
            if (!c && this.length > 0) {
                h = a(this[0]);
                var p = h.data(a.mask.dataName);
                return p ? p() : void 0
            }
            return g = a.extend({
                autoclear: a.mask.autoclear,
                placeholder: a.mask.placeholder,
                completed: null
            }, g), i = a.mask.definitions, j = [], k = n = c.length, l = null, a.each(c.split(""), function (a, b) {
                "?" == b ? (n--, k = a) : i[b] ? (j.push(new RegExp(i[b])), null === l && (l = j.length - 1), k > a && (m = j.length - 1)) : j.push(null)
            }), this.trigger("unmask").each(function () {
                function h() {
                    if (g.completed) {
                        for (var a = l; m >= a; a++) if (j[a] && C[a] === p(a)) return;
                        g.completed.call(B)
                    }
                }

                function p(a) {
                    return g.placeholder.charAt(a < g.placeholder.length ? a : 0)
                }

                function q(a) {
                    for (; ++a < n && !j[a];) ;
                    return a
                }

                function r(a) {
                    for (; --a >= 0 && !j[a];) ;
                    return a
                }

                function s(a, b) {
                    var c, d;
                    if (!(0 > a)) {
                        for (c = a, d = q(b); n > c; c++) if (j[c]) {
                            if (!(n > d && j[c].test(C[d]))) break;
                            C[c] = C[d], C[d] = p(d), d = q(d)
                        }
                        z(), B.caret(Math.max(l, a))
                    }
                }

                function t(a) {
                    var b, c, d, e;
                    for (b = a, c = p(a); n > b; b++) if (j[b]) {
                        if (d = q(b), e = C[b], C[b] = c, !(n > d && j[d].test(e))) break;
                        c = e
                    }
                }

                function u() {
                    var a = B.val(), b = B.caret();
                    if (o && o.length && o.length > a.length) {
                        for (A(!0); b.begin > 0 && !j[b.begin - 1];) b.begin--;
                        if (0 === b.begin) for (; b.begin < l && !j[b.begin];) b.begin++;
                        B.caret(b.begin, b.begin)
                    } else {
                        for (A(!0); b.begin < n && !j[b.begin];) b.begin++;
                        B.caret(b.begin, b.begin)
                    }
                    h()
                }

                function v() {
                    A(), B.val() != E && B.change()
                }

                function w(a) {
                    if (!B.prop("readonly")) {
                        var b, c, e, f = a.which || a.keyCode;
                        o = B.val(), 8 === f || 46 === f || d && 127 === f ? (b = B.caret(), c = b.begin, e = b.end, e - c === 0 && (c = 46 !== f ? r(c) : e = q(c - 1), e = 46 === f ? q(e) : e), y(c, e), s(c, e - 1), a.preventDefault()) : 13 === f ? v.call(this, a) : 27 === f && (B.val(E), B.caret(0, A()), a.preventDefault())
                    }
                }

                function x(b) {
                    if (!B.prop("readonly")) {
                        var c, d, e, g = b.which || b.keyCode, i = B.caret();
                        if (!(b.ctrlKey || b.altKey || b.metaKey || 32 > g) && g && 13 !== g) {
                            if (i.end - i.begin !== 0 && (y(i.begin, i.end), s(i.begin, i.end - 1)), c = q(i.begin - 1), n > c && (d = String.fromCharCode(g), j[c].test(d))) {
                                if (t(c), C[c] = d, z(), e = q(c), f) {
                                    var k = function () {
                                        a.proxy(a.fn.caret, B, e)()
                                    };
                                    setTimeout(k, 0)
                                } else B.caret(e);
                                i.begin <= m && h()
                            }
                            b.preventDefault()
                        }
                    }
                }

                function y(a, b) {
                    var c;
                    for (c = a; b > c && n > c; c++) j[c] && (C[c] = p(c))
                }

                function z() {
                    B.val(C.join(""))
                }

                function A(a) {
                    var b, c, d, e = B.val(), f = -1;
                    for (b = 0, d = 0; n > b; b++) if (j[b]) {
                        for (C[b] = p(b); d++ < e.length;) if (c = e.charAt(d - 1), j[b].test(c)) {
                            C[b] = c, f = b;
                            break
                        }
                        if (d > e.length) {
                            y(b + 1, n);
                            break
                        }
                    } else C[b] === e.charAt(d) && d++, k > b && (f = b);
                    return a ? z() : k > f + 1 ? g.autoclear || C.join("") === D ? (B.val() && B.val(""), y(0, n)) : z() : (z(), B.val(B.val().substring(0, f + 1))), k ? b : l
                }

                var B = a(this), C = a.map(c.split(""), function (a, b) {
                    return "?" != a ? i[a] ? p(b) : a : void 0
                }), D = C.join(""), E = B.val();
                B.data(a.mask.dataName, function () {
                    return a.map(C, function (a, b) {
                        return j[b] && a != p(b) ? a : null
                    }).join("")
                }), B.one("unmask", function () {
                    B.off(".mask").removeData(a.mask.dataName)
                }).on("focus.mask", function () {
                    if (!B.prop("readonly")) {
                        clearTimeout(b);
                        var a;
                        E = B.val(), a = A(), b = setTimeout(function () {
                            B.get(0) === document.activeElement && (z(), a == c.replace("?", "").length ? B.caret(0, a) : B.caret(a))
                        }, 10)
                    }
                }).on("blur.mask", v).on("keydown.mask", w).on("keypress.mask", x).on("input.mask paste.mask", function () {
                    B.prop("readonly") || setTimeout(function () {
                        var a = A(!0);
                        B.caret(a), h()
                    }, 0)
                }), e && f && B.off("input.mask").on("input.mask", u), A()
            })
        }
    })
});
